# Анализ базы данных: Проблемы и улучшения

Перед основным отчетом хотелось бы сказать, что в целом таблицы `orders` и `orders_article` весьма странные и кривые если можно так сказать...)

Если они такие и правда боевые, то это очевидно вызвано бесконечным неосмысленным добавлением новых полей, в целом к сожалению знакомо

Ниже будет отчет и файл с попыткой улучшить структуру этих таблиц, хочется отметить что конечно немного нехватает общего контекста для понимая всех
деталей и некоторых полей со странными названиями или практически дублирующими друг друга (некоторые я удалил),
хотя вероятно в живом проекте они очень нужны (но тогда это костыли скорее всего).

### **Таблица `orders` имеет 74 поля**

### В процессе анализа таблицы заказов были выделены основные проблемы текущей схемы

### **Основные проблемы текущей схемы:**

1. Нарушение нормализации (избыточность данных)

        Например адреса доставки (были вынесены в новую таблицу `orders_delivery`) : 9 полей дублируют структуру адреса (delivery_country, delivery_region, delivery_city, delivery_address, delivery_building, delivery_index, delivery_apartment_office)

        Или сроки доставки: 8 полей с датами доставки разных типов - явное нарушение (часть из них я как раз удалил (но возможно что они все нужны, но страаано))

2. Проблемы с типами данных

       Например, устаревшие/неоптимальные типы:
       delivery DOUBLE - Должен быть DECIMAL для денег
       weight_gross DOUBLE - Должен быть DECIMAL для веса
       discount SMALLINT - процент как целое число? может конечно, но лучше все таки сделать дробным

3. Избыточность и дублирование

       Как пример дублирование финансовых данных:
       delivery DOUBLE -- стоимость доставки
       delivery_price_euro DOUBLE -- та же стоимость в евро
       cur_rate DOUBLE -- курс
       currency VARCHAR(3)
       payment_euro TINYINT(1) -- флаг оплаты в евро
       оставив тип валюты только в заказе и дальше всегда можно его будет получить из него

4. Плохая индексация

       Бессмысленные и непонятные имена индексов:
       - `create index IDX_1 on orders (delivery_country)`
       - `create index IDX_2 on orders (user_id)`
       - `create index IDX_318C0B7C7294869C on orders_article (article_id)`

5. Отсутствуют важные индексы для частых запросов:

       Например,
       Нет индекса по status + create_date (кроме IDX_4)
       Нет индекса по email для поиска заказов
       Нет индекса по tracking_number для отслеживания

6. Проблемы с NULL-ability, критические поля допускают NULL:

       user_id NULL - заказ без пользователя?
       email NULL - заказ без контакта?
       number VARCHAR(10) NULL -- заказ без номера?
       и тд

7. Смешение различных сущностей таблица содержит данные:

        Заказ (основная сущность)
        Клиент (контактные данные)
        Доставка (адрес, сроки)
        Менеджер (данные сотрудника)
        Логистика (перевозчик, трекинг)
        Финансы (курсы, валюты)
        Маркетинг (отзывы, сообщения)

8. Из этого получаем проблемы производительности

        Широкая таблица (70+ полей)
        LONGTEXT поля (warehouse_data, bank_details)
        Отсутствие составных индексов для частых сценариев
        avg_row_length = 2209 - большая строка

9. Отсутствие внешних ключей

        user_id без связи с таблицей пользователей
        delivery_country без связи с таблицей стран
        orders_id в orders_article без FK
        И много похожих моментов

### **В целом таблица `orders_article` имеет схожие проблемы и по ней писать то же самое не имеет особого смысла**

### **В итоге в ходе оптимизации и нормализации бд была улучшена нормализация данных, изменены типы данных, добавлены новые индексы, удалены некоторые поля, и для читаемости изменен порядок некоторых полей.**

### **Полные изменения можно посмотреть в файле reviewed_damp.sql**

### P.S в некоторых доп таблицах вроде managers есть небольшие недочеты тк они больше для общего вида и делались на скорую руку ((
